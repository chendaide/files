import{_ as e,r as a,n as l,c as t,o as s,b as u,h as n,y as o,j as r,i as d,e as i,U as c,k as p,l as v,t as m,x as f,B as g,F as y,C as w,E as _}from"./index-DgsTEpUf.js";import{e as b,f as h,u as k,h as x}from"./admin-jtg1Qoei.js";import"./request-DczqgLPf.js";const V={class:"page"},C={class:"page-header"},z={class:"filters"},U={class:"card"},I={class:"user-cell"},S={class:"user-info"},j={class:"name"},q={class:"sub"},E={key:1,class:"admin-tip"},M={class:"pagination"},A=e({__name:"UserManage",setup(e){const A=a([]),B=a(!1),D=a(""),F=a(null),K=a(1),P=a(10),G=a(0),H=a(!1),J=a(null),L=a({userId:null,points:0,reason:""}),N=async()=>{var e,a;B.value=!0;try{const l=await b({keyword:D.value,status:F.value,page:K.value,size:P.value});A.value=(null==(e=l.data)?void 0:e.list)||[],G.value=(null==(a=l.data)?void 0:a.total)||0}finally{B.value=!1}},O=async()=>{L.value.reason?(await x(L.value.userId,L.value.points,L.value.reason),_.success("调整成功"),H.value=!1,N()):_.warning("请输入调整原因")};return l(N),(e,a)=>{const l=r("el-input"),b=r("el-option"),x=r("el-select"),Q=r("el-button"),R=r("el-table-column"),T=r("el-avatar"),W=r("el-tag"),X=r("el-table"),Y=r("el-pagination"),Z=r("el-form-item"),$=r("el-input-number"),ee=r("el-form"),ae=r("el-dialog"),le=c("loading");return s(),t("div",V,[u("div",C,[a[8]||(a[8]=u("h1",{class:"page-title"},"用户管理",-1)),u("div",z,[n(l,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e),placeholder:"搜索用户名/学号",clearable:"",style:{width:"200px"},onKeyup:o(N,["enter"])},null,8,["modelValue"]),n(x,{modelValue:F.value,"onUpdate:modelValue":a[1]||(a[1]=e=>F.value=e),placeholder:"状态",clearable:"",style:{width:"120px"},onChange:N},{default:d(()=>[n(b,{label:"正常",value:0}),n(b,{label:"封禁",value:1})]),_:1},8,["modelValue"]),n(Q,{type:"primary",onClick:N},{default:d(()=>[...a[7]||(a[7]=[v("搜索",-1)])]),_:1})])]),u("div",U,[i((s(),p(X,{data:A.value},{default:d(()=>[n(R,{prop:"id",label:"ID",width:"70"}),n(R,{label:"用户","min-width":"200"},{default:d(({row:e})=>[u("div",I,[n(T,{size:36,src:e.avatar},{default:d(()=>{var a;return[v(m(null==(a=e.username)?void 0:a.charAt(0)),1)]}),_:2},1032,["src"]),u("div",S,[u("span",j,[v(m(e.username),1),1===e.role?(s(),p(W,{key:0,size:"small",type:"danger",style:{"margin-left":"6px"}},{default:d(()=>[...a[9]||(a[9]=[v("管理员",-1)])]),_:1})):f("",!0)]),u("span",q,m(e.studentId),1)])])]),_:1}),n(R,{prop:"email",label:"邮箱","min-width":"180","show-overflow-tooltip":""}),n(R,{prop:"creditScore",label:"信用分",width:"90",align:"center"},{default:d(({row:e})=>[u("span",{class:g(["credit",e.creditScore>=80?"good":e.creditScore>=60?"warn":"bad"])},m(e.creditScore),3)]),_:1}),n(R,{label:"状态",width:"90",align:"center"},{default:d(({row:e})=>[u("span",{class:g(["status",0===e.status?"active":"banned"])},m(0===e.status?"正常":"封禁"),3)]),_:1}),n(R,{label:"操作",width:"180",fixed:"right"},{default:d(({row:e})=>[1!==e.role?(s(),t(y,{key:0},[0===e.status?(s(),p(Q,{key:0,type:"danger",size:"small",text:"",onClick:a=>(async e=>{const{value:a}=await w.prompt("请输入封禁原因","封禁用户",{inputPattern:/.+/,inputErrorMessage:"请输入原因"});await h(e.id,a),_.success("封禁成功"),N()})(e)},{default:d(()=>[...a[10]||(a[10]=[v("封禁",-1)])]),_:1},8,["onClick"])):(s(),p(Q,{key:1,type:"primary",size:"small",text:"",onClick:a=>(async e=>{await w.confirm("确定解封该用户吗？","提示"),await k(e.id),_.success("解封成功"),N()})(e)},{default:d(()=>[...a[11]||(a[11]=[v("解封",-1)])]),_:1},8,["onClick"])),n(Q,{type:"warning",size:"small",text:"",onClick:a=>(e=>{J.value=e,L.value={userId:e.id,points:0,reason:""},H.value=!0})(e)},{default:d(()=>[...a[12]||(a[12]=[v("调整信用",-1)])]),_:1},8,["onClick"])],64)):(s(),t("span",E,"管理员账户"))]),_:1})]),_:1},8,["data"])),[[le,B.value]]),u("div",M,[n(Y,{"current-page":K.value,"page-size":P.value,total:G.value,background:"",layout:"total, prev, pager, next",onCurrentChange:a[2]||(a[2]=e=>{K.value=e,N()})},null,8,["current-page","page-size","total"])])]),n(ae,{modelValue:H.value,"onUpdate:modelValue":a[6]||(a[6]=e=>H.value=e),title:"调整信用分",width:"400px"},{footer:d(()=>[n(Q,{onClick:a[5]||(a[5]=e=>H.value=!1)},{default:d(()=>[...a[14]||(a[14]=[v("取消",-1)])]),_:1}),n(Q,{type:"primary",onClick:O},{default:d(()=>[...a[15]||(a[15]=[v("确定",-1)])]),_:1})]),default:d(()=>[n(ee,{model:L.value,"label-width":"80px"},{default:d(()=>[n(Z,{label:"当前信用"},{default:d(()=>[n(W,null,{default:d(()=>{var e;return[v(m((null==(e=J.value)?void 0:e.creditScore)||0)+" 分",1)]}),_:1})]),_:1}),n(Z,{label:"调整分数"},{default:d(()=>[n($,{modelValue:L.value.points,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value.points=e),min:-50,max:50,step:5},null,8,["modelValue"]),a[13]||(a[13]=u("span",{class:"tip"},"正数增加，负数扣除",-1))]),_:1}),n(Z,{label:"原因"},{default:d(()=>[n(l,{modelValue:L.value.reason,"onUpdate:modelValue":a[4]||(a[4]=e=>L.value.reason=e),type:"textarea",rows:3,placeholder:"请输入调整原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-9a229cf2"]]);export{A as default};
