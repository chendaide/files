import{_ as a,r as l,m as s,n as e,g as t,c as i,o as u,b as r,l as n,x as c,F as v,z as o,t as d,B as p,E as m,u as g,C as h}from"./index-DgsTEpUf.js";import{a as b}from"./product-DTdrY-bL.js";import{c as f}from"./order-CFFxLi2s.js";import{g as y}from"./verification-B-_pL_qt.js";import"./request-DczqgLPf.js";const k={class:"detail-page"},x={class:"navbar"},w={class:"nav-container"},I={key:0,class:"main-content"},C={class:"product-gallery"},_={class:"gallery-main"},j=["src","alt"],B={key:0,class:"gallery-thumbs"},$=["onClick"],q=["src","alt"],M={class:"product-details"},z={class:"product-header"},S={class:"product-title"},T={class:"product-price"},D={class:"price-value"},E={class:"product-meta"},F={class:"meta-item"},H={class:"meta-item"},J={class:"product-description"},N={class:"product-actions"},O=["disabled"],P=["disabled"],A={key:1,class:"loading-state"},G=a({__name:"ProductDetail",setup(a){const G=t(),K=g(),L=l(null),Q=l(0),R=l(!1),U=s(()=>JSON.parse(localStorage.getItem("userInfo")||"null")),V=s(()=>L.value?L.value.images?L.value.images.split(",").filter(a=>a):L.value.mainImage?[L.value.mainImage]:[]:[]),W=s(()=>{var a;return V.value[Q.value]||(null==(a=L.value)?void 0:a.mainImage)}),X={1:{text:"在售",class:"success"},2:{text:"已预订",class:"warning"},3:{text:"已售出",class:"info"},4:{text:"已下架",class:"danger"}},Y=s(()=>{var a,l;return(null==(l=X[null==(a=L.value)?void 0:a.status])?void 0:l.text)||"未知"}),Z=s(()=>{var a,l;return(null==(l=X[null==(a=L.value)?void 0:a.status])?void 0:l.class)||""});e(async()=>{var a;const l=await b(G.params.id);if(L.value=l.data,U.value)try{const l=await y();R.value=1===(null==(a=l.data)?void 0:a.status)}catch(s){}});const aa=()=>{if(!U.value)return m.warning("请先登录"),void K.push("/login");K.push({path:"/chat",query:{userId:L.value.sellerId}})},la=async()=>{if(!U.value)return m.warning("请先登录"),void K.push("/login");if(R.value)try{await h.confirm(`确定购买「${L.value.title}」？`,"确认购买"),await f({productId:L.value.id,buyerId:U.value.id}),m.success("下单成功"),K.push("/orders")}catch(a){"cancel"===a||a._handled||m.error(a.message||"下单失败")}else h.confirm("购买商品需要先完成实名认证，认证后可享受完整交易功能","需要实名认证",{confirmButtonText:"去认证",cancelButtonText:"取消"}).then(()=>K.push("/real-name-verify")).catch(()=>{})};return(a,l)=>{var s,e;return u(),i("div",k,[r("nav",x,[r("div",w,[r("button",{class:"btn-back",onClick:l[0]||(l[0]=l=>a.$router.back())},[...l[2]||(l[2]=[r("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[r("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),n(" 返回 ",-1)])]),r("div",{class:"nav-brand",onClick:l[1]||(l[1]=l=>a.$router.push("/"))},"校园集市")])]),L.value?(u(),i("main",I,[r("div",C,[r("div",_,[r("img",{src:W.value,alt:L.value.title},null,8,j)]),V.value.length>1?(u(),i("div",B,[(u(!0),i(v,null,o(V.value,(a,l)=>(u(),i("div",{key:l,class:p(["thumb-item",{active:Q.value===l}]),onClick:a=>Q.value=l},[r("img",{src:a,alt:`图片${l+1}`},null,8,q)],10,$))),128))])):c("",!0)]),r("div",M,[r("div",z,[r("h1",S,d(L.value.title),1),r("div",T,[l[3]||(l[3]=r("span",{class:"price-symbol"},"¥",-1)),r("span",D,d(L.value.price),1)])]),r("div",E,[r("div",F,[l[4]||(l[4]=r("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[r("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),r("circle",{cx:"12",cy:"12",r:"3"})],-1)),r("span",null,d(L.value.viewCount||0)+" 次浏览",1)]),r("div",H,[r("span",{class:p(["status-badge",Z.value])},d(Y.value),3)])]),r("div",J,[l[5]||(l[5]=r("h3",null,"商品描述",-1)),r("p",null,d(L.value.description||"暂无描述"),1)]),r("div",N,[r("button",{class:"btn-primary",disabled:1!==L.value.status||L.value.sellerId===(null==(s=U.value)?void 0:s.id),onClick:la},d(1===L.value.status?"立即购买":Y.value),9,O),r("button",{class:"btn-secondary",disabled:L.value.sellerId===(null==(e=U.value)?void 0:e.id),onClick:aa}," 联系卖家 ",8,P)])])])):(u(),i("div",A,[...l[6]||(l[6]=[r("div",{class:"spinner"},null,-1),r("p",null,"加载中...",-1)])]))])}}},[["__scopeId","data-v-1965b452"]]);export{G as default};
