import{_ as s,r as a,m as e,a as l,n as t,c as i,o as n,b as c,l as r,t as u,B as o,x as v,F as d,z as m,w as p,e as f,v as b,E as y,u as g,C as k}from"./index-DgsTEpUf.js";import{b as h,u as C,d as w}from"./product-DTdrY-bL.js";import{u as x}from"./user-BBBixgcQ.js";import{g as I}from"./verification-B-_pL_qt.js";import"./request-DczqgLPf.js";const E={class:"profile-page"},V={class:"navbar"},B={class:"nav-container"},P={class:"main-content"},S={class:"sidebar"},N={class:"user-card"},_=["src","alt"],j={class:"user-name"},z={class:"user-id"},M={class:"credit-score"},D={class:"score-value"},O={class:"verify-card"},q={class:"sidebar-nav"},H={class:"content-area"},$={key:0,class:"products-section"},A={key:0,class:"products-list"},G=["src","alt","onClick"],J=["onClick"],R={class:"item-price"},T={class:"item-actions"},F=["onClick"],U=["onClick"],K=["onClick"],L=["onClick"],Q={key:1,class:"empty-state"},W={key:1,class:"settings-section"},X={class:"form-group"},Y=s({__name:"Profile",setup(s){var Y;const Z=g(),ss=a("products"),as=a([]),es=a(null),ls=e(()=>JSON.parse(localStorage.getItem("userInfo")||"null")),ts=l({email:(null==(Y=ls.value)?void 0:Y.email)||""}),is={1:{text:"在售",class:"success"},2:{text:"已预订",class:"warning"},3:{text:"已售出",class:"info"},4:{text:"已下架",class:"danger"}},ns=async()=>{var s;if(null==(s=ls.value)?void 0:s.id){const s=await h(ls.value.id);as.value=s.data||[]}},cs=async()=>{try{await x({id:ls.value.id,email:ts.email});const s={...ls.value,email:ts.email};localStorage.setItem("userInfo",JSON.stringify(s)),y.success("保存成功")}catch(s){s._handled||y.error(s.message||"保存失败")}},rs=()=>{var s;(null==(s=ls.value)?void 0:s.emailVerified)?y.success("邮箱已验证"):Z.push("/email-verify")},us=()=>{Z.push("/real-name-verify")},os=e(()=>{var s;const a=null==(s=es.value)?void 0:s.status;return 1===a||"APPROVED"===a?"verified":0===a||"PENDING"===a?"pending":"unverified"}),vs=e(()=>{var s;const a=null==(s=es.value)?void 0:s.status;return 1===a||"APPROVED"===a?"已认证":0===a||"PENDING"===a?"审核中":"未认证"}),ds=()=>{var s;(null==(s=ls.value)?void 0:s.emailVerified)?Z.push("/publish"):k.confirm("发布商品需要先完成邮箱验证，是否前往验证？","提示",{confirmButtonText:"去验证",cancelButtonText:"取消"}).then(()=>Z.push("/email-verify")).catch(()=>{})};return t(()=>{ns(),(async()=>{try{const s=await I();es.value=s.data}catch(s){}})()}),(s,a)=>{var e,l,t,g,h,x,I;return n(),i("div",E,[c("nav",V,[c("div",B,[c("button",{class:"btn-back",onClick:a[0]||(a[0]=a=>s.$router.push("/"))},[...a[4]||(a[4]=[c("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[c("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),r(" 返回首页 ",-1)])]),a[5]||(a[5]=c("div",{class:"nav-brand"},"个人中心",-1))])]),c("main",P,[c("aside",S,[c("div",N,[c("img",{src:(null==(e=ls.value)?void 0:e.avatar)||'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2386868b"%3E%3Cpath d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/%3E%3C/svg%3E',alt:null==(l=ls.value)?void 0:l.username,class:"user-avatar"},null,8,_),c("h2",j,u(null==(t=ls.value)?void 0:t.username),1),c("p",z,"学号: "+u(null==(g=ls.value)?void 0:g.studentId),1),c("div",M,[a[6]||(a[6]=c("span",{class:"score-label"},"信用分",-1)),c("span",D,u((null==(h=ls.value)?void 0:h.creditScore)||100),1)])]),c("div",O,[c("div",{class:"verify-item",onClick:rs},[a[7]||(a[7]=c("div",{class:"verify-info"},[c("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[c("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),c("polyline",{points:"22,6 12,13 2,6"})]),c("span",null,"邮箱验证")],-1)),c("span",{class:o(["verify-status",(null==(x=ls.value)?void 0:x.emailVerified)?"verified":"unverified"])},u((null==(I=ls.value)?void 0:I.emailVerified)?"已验证":"未验证"),3)]),c("div",{class:"verify-item",onClick:us},[a[8]||(a[8]=c("div",{class:"verify-info"},[c("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[c("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),c("circle",{cx:"12",cy:"7",r:"4"})]),c("span",null,"实名认证")],-1)),c("span",{class:o(["verify-status",os.value])},u(vs.value),3)])]),c("nav",q,[c("button",{class:o({active:"products"===ss.value}),onClick:a[1]||(a[1]=s=>ss.value="products")}," 我的发布 ",2),c("button",{class:o({active:"settings"===ss.value}),onClick:a[2]||(a[2]=s=>ss.value="settings")}," 账号设置 ",2)])]),c("section",H,["products"===ss.value?(n(),i("div",$,[a[10]||(a[10]=c("h3",null,"我的发布",-1)),as.value.length?(n(),i("div",A,[(n(!0),i(d,null,m(as.value,a=>{var e,l;return n(),i("div",{key:a.id,class:"product-item"},[c("img",{src:a.mainImage,alt:a.title,class:"item-image",onClick:e=>s.$router.push("/product/"+a.id)},null,8,G),c("div",{class:"item-info",onClick:e=>s.$router.push("/product/"+a.id)},[c("h4",null,u(a.title),1),c("p",R,"¥"+u(a.price),1)],8,J),c("span",{class:o(["item-status",null==(e=is[a.status])?void 0:e.class])},u(null==(l=is[a.status])?void 0:l.text),3),c("div",T,[c("button",{class:"btn-sm btn-edit",onClick:s=>(s=>{Z.push({path:"/publish",query:{id:s.id}})})(a)},"编辑",8,F),1===a.status?(n(),i("button",{key:0,class:"btn-sm btn-warning",onClick:s=>(async s=>{await k.confirm("确定下架该商品?","提示"),await C(s.id,4),y.success("已下架"),ns()})(a)},"下架",8,U)):v("",!0),4===a.status?(n(),i("button",{key:1,class:"btn-sm btn-success",onClick:s=>(async s=>{await C(s.id,1),y.success("已上架"),ns()})(a)},"上架",8,K)):v("",!0),c("button",{class:"btn-sm btn-danger",onClick:s=>(async s=>{await k.confirm("确定删除该商品?","提示"),await w(s),y.success("删除成功"),ns()})(a.id)},"删除",8,L)])])}),128))])):(n(),i("div",Q,[a[9]||(a[9]=c("p",null,"暂无发布的商品",-1)),c("button",{class:"btn-primary",onClick:ds},"发布商品")]))])):v("",!0),"settings"===ss.value?(n(),i("div",W,[a[13]||(a[13]=c("h3",null,"账号设置",-1)),c("form",{class:"settings-form",onSubmit:p(cs,["prevent"])},[c("div",X,[a[11]||(a[11]=c("label",null,"邮箱",-1)),f(c("input",{"onUpdate:modelValue":a[3]||(a[3]=s=>ts.email=s),type:"email",placeholder:"请输入邮箱"},null,512),[[b,ts.email]])]),a[12]||(a[12]=c("button",{type:"submit",class:"btn-primary"},"保存修改",-1))],32)])):v("",!0)])])])}}},[["__scopeId","data-v-062e1db4"]]);export{Y as default};
