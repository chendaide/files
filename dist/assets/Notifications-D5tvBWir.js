import{_ as a,r as e,n as t,c as s,o as i,h as n,i as l,j as o,k as c,x as r,F as u,z as d,B as p,b as v,K as y,L as f,M as g,N as k,O as m,t as h,l as _,E as R}from"./index-DgsTEpUf.js";import{r as z}from"./request-DczqgLPf.js";const E={class:"notifications-page"},C={class:"card-header"},S={key:1,class:"notification-list"},w=["onClick"],x={class:"notification-icon"},b={class:"notification-content"},j={class:"time"},M=a({__name:"Notifications",setup(a){const M=e([]),q=e(1),D=e(20),L=e(0),N=async()=>{var a,e;try{const t=await function(a=1,e=20){return z.get("/notifications",{params:{page:a,size:e}})}(q.value,D.value);M.value=(null==(a=t.data)?void 0:a.list)||[],L.value=(null==(e=t.data)?void 0:e.total)||0}catch(t){}},O=async a=>{var e;a.isRead||(await(e=a.id,z.put(`/notifications/${e}/read`)),a.isRead=!0)},T=async()=>{try{await z.put("/notifications/read-all"),M.value.forEach(a=>a.isRead=!0),R.success("已全部标记为已读")}catch(a){}},A=a=>{q.value=a,N()};return t(N),(a,e)=>{const t=o("el-button"),R=o("el-empty"),z=o("el-icon"),N=o("el-tag"),B=o("el-pagination"),F=o("el-card");return i(),s("div",E,[n(F,null,{header:l(()=>[v("div",C,[e[1]||(e[1]=v("span",null,"消息通知",-1)),n(t,{type:"primary",link:"",onClick:T},{default:l(()=>[...e[0]||(e[0]=[_("全部已读",-1)])]),_:1})])]),default:l(()=>[M.value.length?(i(),s("div",S,[(i(!0),s(u,null,d(M.value,a=>{return i(),s("div",{key:a.id,class:p(["notification-item",{unread:!a.isRead}]),onClick:e=>O(a)},[v("div",x,[n(z,{size:24},{default:l(()=>["SYSTEM"===a.type?(i(),c(y(f),{key:0})):"MESSAGE"===a.type?(i(),c(y(g),{key:1})):"ORDER"===a.type?(i(),c(y(k),{key:2})):(i(),c(y(m),{key:3}))]),_:2},1024)]),v("div",b,[v("h4",null,h(a.title),1),v("p",null,h(a.content),1),v("span",j,h((t=a.createTime,t?new Date(t).toLocaleString():"")),1)]),a.isRead?r("",!0):(i(),c(N,{key:0,type:"danger",size:"small"},{default:l(()=>[...e[2]||(e[2]=[_("未读",-1)])]),_:1}))],10,w);var t}),128))])):(i(),c(R,{key:0,description:"暂无通知"})),L.value>D.value?(i(),c(B,{key:2,"current-page":q.value,"page-size":D.value,total:L.value,onCurrentChange:A,layout:"prev, pager, next"},null,8,["current-page","page-size","total"])):r("",!0)]),_:1})])}}},[["__scopeId","data-v-251a0fb0"]]);export{M as default};
