import{_ as e,m as a,r as l,n as s,c as u,o as n,b as t,l as v,B as i,t as r,F as o,x as c,e as d,v as p,E as m,u as b}from"./index-DgsTEpUf.js";import{s as f,v as y}from"./user-BBBixgcQ.js";import"./request-DczqgLPf.js";const h={class:"verify-page"},k={class:"navbar"},g={class:"nav-container"},w={class:"main-content"},x={class:"verify-card"},C={class:"card-header"},I={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},V={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},_={key:0},B={key:1},M={class:"form-section"},S={class:"form-group"},j={class:"input-with-btn"},$=["disabled"],q=["disabled"],E={key:0,class:"form-group"},H=["disabled"],J=e({__name:"EmailVerify",setup(e){var J;b();const N=a(()=>JSON.parse(localStorage.getItem("userInfo")||"{}")),O=l((null==(J=N.value)?void 0:J.email)||""),U=l(""),z=l(!1),F=l(!1),A=l(!1),D=l(!1),G=l(0);let K=null;const L=async()=>{if(O.value){F.value=!0;try{await f(O.value),m.success("验证码已发送，请查收邮件"),z.value=!0,G.value=60,K=setInterval(()=>{G.value--,G.value<=0&&clearInterval(K)},1e3)}catch(e){e._handled||m.error(e.message||"发送失败，请稍后重试")}finally{F.value=!1}}else m.warning("请输入邮箱地址")},P=async()=>{var e;if(!U.value||U.value.length<6)m.warning("请输入6位验证码");else{A.value=!0;try{await y(O.value,U.value,null==(e=N.value)?void 0:e.id),D.value=!0,m.success("邮箱验证成功！");const a={...N.value,email:O.value,emailVerified:!0};localStorage.setItem("userInfo",JSON.stringify(a))}catch(a){a._handled||m.error(a.message||"验证失败，请检查验证码")}finally{A.value=!1}}};return s(()=>{var e;(null==(e=N.value)?void 0:e.emailVerified)&&(D.value=!0)}),(e,a)=>(n(),u("div",h,[t("nav",k,[t("div",g,[t("button",{class:"btn-back",onClick:a[0]||(a[0]=a=>e.$router.back())},[...a[4]||(a[4]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),v(" 返回 ",-1)])]),a[5]||(a[5]=t("div",{class:"nav-brand"},"邮箱验证",-1))])]),t("main",w,[t("div",x,[t("div",C,[t("div",{class:i(["icon-wrapper",{success:D.value}])},[D.value?(n(),u("svg",V,[...a[7]||(a[7]=[t("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1),t("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)])])):(n(),u("svg",I,[...a[6]||(a[6]=[t("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"},null,-1),t("polyline",{points:"22,6 12,13 2,6"},null,-1)])]))],2),t("h2",null,r(D.value?"验证成功":"验证您的邮箱"),1),D.value?(n(),u("p",B,"您的邮箱已验证，现在可以正常使用所有功能")):(n(),u("p",_,"完成邮箱验证后即可发布商品和购买商品"))]),D.value?(n(),u("button",{key:1,class:"btn-submit",onClick:a[3]||(a[3]=a=>e.$router.push("/"))}," 返回首页 ")):(n(),u(o,{key:0},[t("div",M,[t("div",S,[a[8]||(a[8]=t("label",null,"邮箱地址",-1)),t("div",j,[d(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>O.value=e),type:"email",placeholder:"请输入您的邮箱",disabled:z.value},null,8,$),[[p,O.value]]),t("button",{class:"btn-send",disabled:!O.value||F.value||G.value>0,onClick:L},r(G.value>0?`${G.value}s`:F.value?"发送中...":"发送验证码"),9,q)])]),z.value?(n(),u("div",E,[a[9]||(a[9]=t("label",null,"验证码",-1)),d(t("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>U.value=e),type:"text",placeholder:"请输入6位验证码",maxlength:"6"},null,512),[[p,U.value]])])):c("",!0)]),z.value?(n(),u("button",{key:0,class:"btn-submit",disabled:!U.value||U.value.length<6||A.value,onClick:P},r(A.value?"验证中...":"确认验证"),9,H)):c("",!0)],64))])])]))}},[["__scopeId","data-v-cfa1d3e6"]]);export{J as default};
