import{_ as e,r as a,a as l,c as s,o as r,h as o,i as d,j as t,u,k as i,w as m,b as n,l as p,t as c,E as f}from"./index-DgsTEpUf.js";import{r as g}from"./request-DczqgLPf.js";const w={class:"forgot-password-page"},b={class:"back-link"},v={class:"back-link"},_=e({__name:"ForgotPassword",setup(e){const _=u(),y=a(1),k=a(!1),V=a(null),h=a(null),q=l({email:""}),P=l({code:"",password:"",confirmPassword:""}),x={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},U={code:[{required:!0,message:"请输入验证码",trigger:"blur"}],password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a,l)=>{a!==P.password?l(new Error("两次密码不一致")):l()},trigger:"blur"}]},j=async()=>{await V.value.validate(),k.value=!0;try{await g.post("/password-reset/request",{email:q.email}),f.success("验证码已发送"),y.value=2}finally{k.value=!1}},F=async()=>{await h.value.validate(),k.value=!0;try{await g.post("/password-reset/reset",{email:q.email,code:P.code,newPassword:P.password}),f.success("密码重置成功"),_.push("/login")}finally{k.value=!1}};return(e,a)=>{const l=t("el-input"),u=t("el-form-item"),f=t("el-button"),g=t("router-link"),_=t("el-form"),E=t("el-alert"),R=t("el-card");return r(),s("div",w,[o(R,{class:"form-card"},{header:d(()=>[n("h2",null,c(1===y.value?"找回密码":"重置密码"),1)]),default:d(()=>[1===y.value?(r(),i(_,{key:0,model:q,rules:x,ref_key:"emailFormRef",ref:V,onSubmit:m(j,["prevent"])},{default:d(()=>[o(u,{label:"邮箱",prop:"email"},{default:d(()=>[o(l,{modelValue:q.email,"onUpdate:modelValue":a[0]||(a[0]=e=>q.email=e),placeholder:"请输入注册邮箱","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),o(u,null,{default:d(()=>[o(f,{type:"primary","native-type":"submit",loading:k.value,class:"submit-btn"},{default:d(()=>[...a[5]||(a[5]=[p(" 发送重置链接 ",-1)])]),_:1},8,["loading"])]),_:1}),n("div",b,[o(g,{to:"/login"},{default:d(()=>[...a[6]||(a[6]=[p("返回登录",-1)])]),_:1})])]),_:1},8,["model"])):(r(),i(_,{key:1,model:P,rules:U,ref_key:"resetFormRef",ref:h,onSubmit:m(F,["prevent"])},{default:d(()=>[o(E,{type:"success",closable:!1,class:"tip-alert"},{default:d(()=>[p(" 验证码已发送至 "+c(q.email),1)]),_:1}),o(u,{label:"验证码",prop:"code"},{default:d(()=>[o(l,{modelValue:P.code,"onUpdate:modelValue":a[1]||(a[1]=e=>P.code=e),placeholder:"请输入6位验证码",maxlength:"6"},null,8,["modelValue"])]),_:1}),o(u,{label:"新密码",prop:"password"},{default:d(()=>[o(l,{modelValue:P.password,"onUpdate:modelValue":a[2]||(a[2]=e=>P.password=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(u,{label:"确认密码",prop:"confirmPassword"},{default:d(()=>[o(l,{modelValue:P.confirmPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>P.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(u,null,{default:d(()=>[o(f,{type:"primary","native-type":"submit",loading:k.value,class:"submit-btn"},{default:d(()=>[...a[7]||(a[7]=[p(" 重置密码 ",-1)])]),_:1},8,["loading"])]),_:1}),n("div",v,[o(f,{link:"",onClick:a[4]||(a[4]=e=>y.value=1)},{default:d(()=>[...a[8]||(a[8]=[p("重新发送",-1)])]),_:1})])]),_:1},8,["model"]))]),_:1})])}}},[["__scopeId","data-v-096040de"]]);export{_ as default};
