import{r as a}from"./request-DczqgLPf.js";import{_ as e,r as l,m as s,n as t,c,o as d,h as u,i as r,j as n,u as o,k as i,b as p,l as v,F as m,z as f,t as h,E as y,C as g}from"./index-DgsTEpUf.js";function k(e){return a.delete(`/cart/${e}`)}const _={class:"cart-page"},b={class:"card-header"},C={key:1},I={class:"cart-list"},V={class:"product-info"},w={class:"price"},x={class:"cart-footer"},j={class:"total"},q=e({__name:"Cart",setup(e){const q=o(),z=l([]),F=l([]),U=l(!1),E=s(()=>z.value.filter(a=>F.value.includes(a.productId)).reduce((a,e)=>a+e.price,0).toFixed(2)),$=async()=>{try{const e=await a.get("/cart");z.value=e.data||[]}catch(e){}},A=a=>{F.value=a?z.value.map(a=>a.productId):[]},B=async()=>{await g.confirm("确定删除选中的商品吗？","提示");for(const a of F.value)await k(a);F.value=[],$()},D=async()=>{try{await(e=F.value,a.post("/cart/checkout",{productIds:e})),y.success("下单成功"),q.push("/orders")}catch(l){}var e};return t($),(a,e)=>{const l=n("el-button"),s=n("el-empty"),t=n("el-checkbox"),o=n("el-image"),g=n("el-card");return d(),c("div",_,[u(g,null,{header:r(()=>[p("div",b,[e[3]||(e[3]=p("span",null,"购物车",-1)),u(l,{type:"danger",size:"small",onClick:B,disabled:!F.value.length},{default:r(()=>[...e[2]||(e[2]=[v(" 删除选中 ",-1)])]),_:1},8,["disabled"])])]),default:r(()=>[z.value.length?(d(),c("div",C,[u(t,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=a=>U.value=a),onChange:A,class:"select-all"},{default:r(()=>[...e[4]||(e[4]=[v(" 全选 ",-1)])]),_:1},8,["modelValue"]),p("div",I,[(d(!0),c(m,null,f(z.value,a=>(d(),c("div",{key:a.id,class:"cart-item"},[u(t,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=a=>F.value=a),label:a.productId},null,8,["modelValue","label"]),u(o,{src:a.mainImage,fit:"cover",class:"product-image"},null,8,["src"]),p("div",V,[p("h4",null,h(a.title),1),p("p",w,"¥"+h(a.price),1)]),u(l,{type:"danger",link:"",onClick:e=>(async a=>{try{await k(a),y.success("已移除"),$()}catch(e){}})(a.productId)},{default:r(()=>[...e[5]||(e[5]=[v(" 移除 ",-1)])]),_:1},8,["onClick"])]))),128))]),p("div",x,[p("span",null,"已选 "+h(F.value.length)+" 件商品",1),p("span",j,"合计: ¥"+h(E.value),1),u(l,{type:"primary",onClick:D,disabled:!F.value.length},{default:r(()=>[...e[6]||(e[6]=[v(" 结算 ",-1)])]),_:1},8,["disabled"])])])):(d(),i(s,{key:0,description:"购物车是空的"}))]),_:1})])}}},[["__scopeId","data-v-330482c9"]]);export{q as default};
